<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday Ishaa!</title>
    <style>
        /* Base styles */
        * { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; box-sizing: border-box; }
        body { position: relative; overflow: hidden; height: 100vh; background: linear-gradient(135deg, #ffb0b0, #ffd0b0); }
        .background { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.3; overflow: hidden; }
        .background .heart, .background .star { position: absolute; opacity: 0.3; font-size: 20px; }
        .background .star { font-size: 15px; }
        @keyframes floatHeart { 0% { transform: translateY(0) rotate(0deg); } 100% { transform: translateY(-100vh) rotate(360deg); } }
        @keyframes twinkleStar { 0%,100% { opacity: 0.1; } 50% { opacity: 0.5; } }

        /* Common page/card/button styles */
        .page { position: absolute; top:0; left:0; width:100%; height:100%; display:flex; justify-content:center; align-items:center; opacity:0; pointer-events:none; transition: opacity 1s ease; padding: 15px; }
        .page.active { opacity:1; pointer-events:all; }
        .card { background:white; padding:20px; border-radius:15px; box-shadow:0 10px 25px rgba(0,0,0,0.1); max-width:500px; width:100%; text-align:center; }
        .sparkle { color:#ff6b6b; font-size:24px; margin-bottom:15px; }
        .message { color:#ff6b6b; font-size:18px; margin-bottom:20px; line-height:1.5; }
        .button-container { display:flex; justify-content:center; gap:15px; margin-top:20px; flex-wrap: wrap; }
        .btn { background-color:#ff8c66; color:white; border:none; padding:10px 20px; border-radius:25px; cursor:pointer; font-weight:500; transition:transform 0.2s; }
        .btn:hover { transform:scale(1.05); }

        /* Music player */
        .music-player { background:white; border-radius:10px; padding:20px; max-width:300px; width:100%; text-align:center; box-shadow:0 5px 15px rgba(0,0,0,0.1); }
        .music-player .album-cover {
            width: 100%;
            max-width: 300px;
            height: auto;
            aspect-ratio: 1/1;
            background: #333;
            border-radius: 5px;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            overflow: hidden;
        }

        .music-player .album-cover img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .music-player .song-title { font-weight:bold; color:#ff6b6b; margin-bottom:5px; }
        .music-player .song-artist { font-size:14px; color:#888; margin-bottom:20px; }
        .music-player .controls { display:flex; justify-content:center; gap:20px; }
        .music-player .control-btn { background:none; border:none; cursor:pointer; font-size:24px; }
        .music-controls { position:fixed; top:20px; right:20px; background:rgba(255,255,255,0.8); width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 3px 10px rgba(0,0,0,0.1); z-index:1000; transition:transform 0.2s; }
        .music-controls:hover { transform:scale(1.1); }

        /* Balloon Game Styles */
        .balloon-game { width:100%; height:100%; position:relative; overflow:hidden; }
        .score-display { position:absolute; top:20px; left:20px; font-size:24px; color:#ff6b6b; z-index:10; }
        .balloon { position:absolute; width:60px; height:80px; border-radius:50% 50% 50% 50% / 60% 60% 40% 40%; cursor:pointer; animation: floatUp 8s linear forwards; transition:transform 0.2s; }
        .balloon::after { content:''; position:absolute; bottom:-20px; left:50%; width:1px; height:20px; background:#666; transform:translateX(-50%); }
        .balloon:hover { transform:scale(1.1); }
        @keyframes floatUp { 0% { bottom:-100px; } 100% { bottom:110vh; } }
        .bonus-popup { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:white; padding:30px; border-radius:15px; text-align:center; box-shadow:0 10px 25px rgba(0,0,0,0.2); z-index:1000; display:none; border:5px dashed #ffd700; max-width: 90%; }
        .bonus-popup.active { display:block; animation: popupAnimation 0.5s ease; }
        @keyframes popupAnimation { 0% { transform:translate(-50%,-50%) scale(0.5); opacity:0; } 100% { transform:translate(-50%,-50%) scale(1); opacity:1; } }

        /* Timeline */
        .timeline-container {
            position: relative;
            display: flex;
            flex-direction: column;
            width: 100%;
            padding: 10px 0;
        }
        
        .timeline-divider {
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: rgba(255,255,255,0.5);
        }
        
        .memory-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            margin-left: 30px;
            max-width: 100%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .memory-card::before {
            content: '';
            position: absolute;
            width: 15px;
            height: 15px;
            background: #ff6b6b;
            border-radius: 50%;
            left: -23px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .memory-card .icon {
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        .memory-card .title {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 5px;
        }

        /* Gallery */
        .gallery-container {
            width: 100%;
            max-width: 900px;
            height: auto;
            padding: 10px;
        }
        
        .gallery-photo {
            background: white;
            padding: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: rotate(-3deg);
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .gallery-photo .image-container {
            width: 100%;
            aspect-ratio: 1/1;
            position: relative;
            overflow: hidden;
        }
        
        .gallery-photo img {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }
        
        .gallery-photo img.active {
            opacity: 1;
        }
        
        .gallery-photo .caption {
            padding: 10px 0;
            text-align: center;
            color: #ff6b6b;
        }

        /* Postcards */
        .postcards-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            width: 100%;
        }
        
        .postcard {
            width: calc(50% - 15px);
            min-height: 120px;
            background: white;
            border-radius: 10px;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .postcard:hover {
            transform: rotate(3deg) scale(1.05);
        }
        
        .postcard:nth-child(even):hover {
            transform: rotate(-3deg) scale(1.05);
        }

        /* Message Button */
        .message-button {
            background-color: #ff5e5e;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: bold;
            margin-top: 20px;
            cursor: pointer;
            transition: transform 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .message-button:hover {
            transform: scale(1.05);
        }
        
        .message-button5 {
            background-color: #ff5e5e;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: bold;
            margin-top: 20px;
            cursor: pointer;
            transition: transform 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-left: 0;
            width: fit-content;
            margin: 20px auto 0;
        }
        
        .message-button5:hover {
            transform: scale(1.05);
        }

        /* Cake Ceremony Page Styles */
        .cake-page .instructions {
            color: #e91e63;
            font-size: 1.2rem;
            margin-bottom: 20px;
            text-align: center;
            padding: 0 10px;
        }

        .cake-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            height: 350px;
            margin: 0 auto;
        }

        .cake {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 10;
        }

        .tier {
            background: #d2691e;
            border-top: 20px solid #fff;
            border-radius: 10px;
            position: relative;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }

        .bottom {
            width: 80%;
            max-width: 300px;
            height: 100px;
            margin: 0 auto;
        }

        .middle {
            width: 60%;
            max-width: 200px;
            height: 80px;
            margin: -10px auto;
        }

        .top {
            width: 40%;
            max-width: 120px;
            height: 60px;
            margin: -10px auto;
        }

        .cake-decoration {
            width: 100px;
            height: 20px;
            background: #ff6b6b;
            border-radius: 50%;
            margin-top: -10px;
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
        }

        .candle {
            position: absolute;
            width: 10px;
            height: 30px;
            background: #fdd835;
            border-radius: 5px;
            cursor: pointer;
            top: -20px;
        }

        .candle::after {
            content: '';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-bottom: 15px solid orange;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .candle.lit::after {
            opacity: 1;
        }

        .knife {
            position: absolute;
            width: 20px;
            height: 80px;
            background: #555;
            border-radius: 5px;
            right: 20%;
            top: 20px;
            cursor: grab;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        /* Final / Celebration */
        .final-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .final-card .heart {
            color: #ff5e5e;
            font-size: 30px;
            margin-bottom: 20px;
        }
        
        .birthday-wish {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 15px;
        }
        
        .signature {
            font-weight: bold;
            margin-top: 15px;
            color: #7b68ee;
        }
        
        .pulse-animation {
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #fd0;
            animation: confetti-fall 5s linear forwards;
        }
        
        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        /* Media Queries for Better Mobile View */
        @media (max-width: 768px) {
            .card {
                padding: 15px;
            }
            
            .button-container {
                gap: 10px;
            }
            
            .btn {
                padding: 8px 16px;
            }
            
            .music-player {
                padding: 15px;
            }
            
            .music-player .album-cover {
                max-width: 250px;
            }
            
            .cake-page .instructions {
                font-size: 1rem;
            }
            
            .postcard {
                width: 100%;
                min-height: 80px;
            }
            
            .memory-card {
                margin-left: 25px;
            }
            
            .timeline-divider {
                left: 15px;
            }
            
            .memory-card::before {
                left: -18px;
            }
            
            .memory-card .icon {
                font-size: 18px;
            }
            
            .birthday-wish {
                font-size: 1.1rem;
            }
        }
        
        @media (max-width: 480px) {
            .sparkle {
                font-size: 20px;
            }
            
            .message {
                font-size: 16px;
            }
            
            .music-player .album-cover {
                max-width: 200px;
            }
            
            .candle {
                height: 25px;
            }
            
            .gallery-photo {
                padding: 8px;
            }
            
            .gallery-photo .caption {
                font-size: 14px;
            }
            
            .postcards-container {
                gap: 10px;
            }
            
            .postcard {
                padding: 12px;
                font-size: 14px;
            }
            
            .message-button, .message-button5 {
                padding: 10px 20px;
                font-size: 14px;
            }
            
            .final-card {
                padding: 20px;
            }
            
            .final-card .heart {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="background"></div>
    <div class="music-controls" id="musicToggle">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ff6b6b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9 18V5l12-2v13"></path>
        <circle cx="6" cy="18" r="3"></circle>
        <circle cx="18" cy="16" r="3"></circle>
    </svg>
    </div>
    <audio id="bgMusic" loop><source src="Background_Music.mp3" type="audio/mpeg"></audio>
    <audio id="balloonPopSound"><source src="pop-sound.mp3" type="audio/mpeg"></audio>

    <!-- Page 1: Intro -->
    <div class="page active" id="page-1">
        <div class="card">
            <div class="sparkle">✨</div>
            <div class="message">Heyy! Ishaa! It's your birthday and I had to do something special...</div>
            <div class="button-container"><button class="btn" onclick="navigateTo(2)">Continue →</button></div>
        </div>
    </div>

    <!-- Page 2: Let's Go -->
    <div class="page" id="page-2">
        <div class="card">
            <div class="sparkle">✨</div>
            <div class="message">Soooo, I prepared this for youuuu</div>
            <div class="button-container">
                <button class="btn" onclick="navigateTo(3)">Let's Go!</button>
                <button class="btn" onclick="navigateTo(3)">Yayy!</button>
            </div>
        </div>
    </div>

    <!-- Page 3: Music Player -->
    <div class="page" id="page-3">
        <div class="music-player">
            <div class="album-cover"><img src="Img1.jpg" alt="Album Cover"></div>
            <div class="song-title">Tum Mile</div>
            <div class="song-artist">Your Favourite</div>
            <div class="controls">
                <button class="control-btn" onclick="previousSong()">⏮</button>
                <button class="control-btn" onclick="toggleMusic()">🎵</button>
                <button class="control-btn" onclick="nextSong()">⏭</button>
            </div>
            <div class="button-container" style="margin-top:20px;"><button class="btn" onclick="navigateTo(4)">Next Page →</button></div>
        </div>
    </div>

    <!-- Page 4: Balloon Game -->
    <div class="page" id="page-4">
        <div class="balloon-game">
            <div class="score-display">🎈 Balloons Popped: <span id="balloonScore">0</span></div>
            <div id="balloonContainer"></div>
            <div class="bonus-popup" id="bonusPopup">
                <div class="bonus-title">🎉 Bonus Reward Unlocked! 🎉</div>
                <div class="bonus-message">Special Surprise For You❤️</div>
                <div class="bonus-message">See you at 8pm</div>
                <div class="bonus-message">Yeyey!</div>
                <button class="btn" onclick="navigateTo(6)">Our Story😍 →</button>
            </div>
        </div>
    </div>

    <!-- Page 5: Cake Ceremony -->
    <div class="page cake-page" id="page-5">
      <div class="instructions">✨ Click each candle to light it, then drag the knife down to cut the cake! ✨</div>
      <div class="cake-container">
          <div class="cake">
              <div class="tier top"></div>
              <div class="tier middle"></div>
              <div class="tier bottom"></div>
              <div class="cake-decoration"></div>
          </div>
          <!-- Candles on top tier positions -->
          <div class="candle" id="c3" style="left:calc(50% + 30px);"></div>
          <div class="candle" id="c2" style="left:50%; transform:translateX(-50%);"></div>
          <div class="candle" id="c1" style="left:calc(50% - 37px);"></div>
          <div class="knife" id="knife"></div>
      </div>
    </div>

    <!-- Page 6: Timeline -->
    <div class="page" id="page-6">
        <div class="card" style="max-width:800px; padding:20px;">
            <h2 style="color:#ff6b6b;margin-bottom:20px;">Our Story</h2>
            <div class="timeline-container">
                <div class="timeline-divider"></div>
                <div class="memory-card">
                    <div class="icon">☀️</div>
                    <div class="title">Starting From Here</div>
                    <div class="description">You know very well why I texted you</div>
                </div>
                <div class="memory-card">
                    <div class="icon">🎵</div>
                    <div class="title">I Enjoyed talking to you</div>
                    <div class="description">You have an amazing music taste, by the way</div>
                </div>
                <div class="memory-card">
                    <div class="icon">📸</div>
                    <div class="title">We Talked</div>
                    <div class="description">We shared deeply and the connection was instant</div>
                </div>
                <div class="memory-card">
                    <div class="icon">✨</div>
                    <div class="title">To be continued...</div>
                    <div class="description">Our story is just beginning</div>
                </div>
            </div>
            <button class="message-button" onclick="navigateTo(7)">Memories are made of this! ❤️</button>
        </div>
    </div>

    <!-- Page 7: Gallery -->
    <div class="page" id="page-7">
        <div class="gallery-container">
            <h2 style="color:white; text-align:center; margin-bottom:20px; font-size: 28px;">Our Gallery & Memories!</h2>
            <div class="gallery-photo">
                <div class="image-container">
                    <img src="Img1.jpg" alt data-index="0" class="active">
                    <img src="Img2.jpg" alt data-index="1">
                    <img src="Img3.jpg" alt data-index="2">
                    <img src="Img4.jpg" alt data-index="3">
                    <img src="Img2.jpg" alt data-index="4">
                </div>
                <div class="caption">Happy Birthday to the one who makes every moment a comic adventure!</div>
            </div>
            <button class="message-button5" onclick="navigateTo(8)">I wrote something epic for you, Madam Jii ❤️</button>
        </div>
    </div>

    <!-- Page 8: Postcards -->
    <div class="page" id="page-8">
        <div style="width:90%; max-width:600px; text-align:center;">
            <h2 style="color:#ff5e5e; font-size:22px; margin-bottom:20px;">SPECIAL POSTCARDS FOR YOU!</h2>
            <div class="postcards-container">
                <div class="postcard" style="background-color:#fff5f5;"><div class="postcard-content">You're the WILD CARD in my life - always full of surprises!</div></div>
                <div class="postcard" style="background-color:#fffff0;"><div class="postcard-content">Like a REVERSE card, you turned my world upside down (in the best way!)</div></div>
                <div class="postcard" style="background-color:#f0fff4;"><div class="postcard-content">You + Me = The ultimate DRAW FOUR partnership!</div></div>
                <div class="postcard" style="background-color:#f0f8ff;"><div class="postcard-content">Our friendship SKIPS all the boring parts!</div></div>
                <div class="postcard" style="background-color:#fff0fa;"><div class="postcard-content">You make every day feel like a WINNING HAND!</div></div>
            </div>
            <button class="message-button" onclick="navigateTo(9)" style="margin-top:30px;">SPECIAL MESSAGE FOR YOU →</button>
        </div>
    </div>

    <!-- Page 9: Final Message -->
    <div class="page" id="page-9">
        <div class="final-card">
            <div class="heart">❤️</div>
            <div class="birthday-wish">HAPPY BIRTHDAY Ishaa! 🎉</div>
            <div class="message">Thanks for being the most fun, wild, and wonderful person in my life. Every day with you is like drawing the perfect card!</div>
            <div class="signature">ILYSM 💜</div>
            <div class="button-container" style="margin-top:20px;">
                <button class="btn" onclick="startCelebration()">🎉 Celebrate! 🎉</button>
                <button class="btn" onclick="navigateTo(1)">Start Over</button>
            </div>
        </div>
    </div>

    <!-- Page 10: Celebration -->
    <div class="page" id="page-10">
        <div class="final-card">
            <div class="heart pulse-animation">❤️</div>
            <div class="birthday-wish">May this year bring you all the happiness and joy you deserve!</div>
            <div id="confetti-container"></div>
            <div class="button-container" style="margin-top:20px;"><button class="btn" onclick="navigateTo(1)">Start Over</button></div>
        </div>
    </div>

    <script>
        // Setup background
        const background = document.querySelector('.background');
        const hearts = ['❤️','💖','💕','💓','💗','💘'];
        const stars = ['✨','⭐','🌟'];
        for(let i=0;i<20;i++){
          const h = document.createElement('div');
          h.className='heart'; h.textContent=hearts[Math.floor(Math.random()*hearts.length)];
          h.style.left=`${Math.random()*100}%`; h.style.top=`${Math.random()*100}%`;
          h.style.animation=`floatHeart ${15+Math.random()*15}s linear ${Math.random()*5}s infinite`;
          background.appendChild(h);
          const s=document.createElement('div');
          s.className='star'; s.textContent=stars[Math.floor(Math.random()*stars.length)];
          s.style.left=`${Math.random()*100}%`; s.style.top=`${Math.random()*100}%`;
          s.style.animation=`twinkleStar ${3+Math.random()*5}s linear ${Math.random()*3}s infinite`;
          background.appendChild(s);
        }
    
        // Navigation & state
        let currentPage=1, autoNavTimer=null, slideshowTimer=null;
        const totalPages=10;
    
        function navigateTo(n){
          if (n === 4 && !isPlaying) {
            // optional: give the user some feedback
            alert('Madam Jii, please start the music first!'); 
            return;
          }

          clearTimeout(autoNavTimer);
          document.querySelector('.page.active').classList.remove('active');
          currentPage=n;
          document.getElementById(`page-${n}`).classList.add('active');
          handlePageEvents();
        }
    
        function handlePageEvents(){
          if(currentPage===4) startBalloonGame(); else stopBalloonGame();
          if(currentPage===7) startImageSlideshow(); else stopImageSlideshow();
          if(currentPage===5) initCakeCeremony();
        }
    
        // Music controls
        const bgMusic=document.getElementById('bgMusic'), musicToggle=document.getElementById('musicToggle'); 
        let isPlaying=false;
        
        musicToggle.addEventListener('click',toggleMusic);
        
        function toggleMusic(){ 
          if(isPlaying) {
            bgMusic.pause();
          } else {
            bgMusic.play().catch(e => {
              console.log("Audio play failed, likely needs user interaction first:", e);
              alert("Please tap the music icon again to start the music!");
            });
          }
          isPlaying=!isPlaying; 
        }
        
        const songs=[{title:"Tum Mile",artist:"Your Favourite",src:"Background_Music.mp3"}]; 
        let currentSongIndex=0;
        
        function previousSong(){ currentSongIndex=(currentSongIndex-1+songs.length)%songs.length; updateSongDisplay(); }
        function nextSong(){ currentSongIndex=(currentSongIndex+1)%songs.length; updateSongDisplay(); }
        function playSong(i){ currentSongIndex=i; updateSongDisplay(); if(!isPlaying) toggleMusic(); }
        function updateSongDisplay(){ 
            document.querySelector('.song-title').textContent=songs[currentSongIndex].title;
          document.querySelector('.song-artist').textContent=songs[currentSongIndex].artist;
        }
    
        // Balloon game logic
        let balloonScore=0, balloonInterval=null;
        const balloonContainer=document.getElementById('balloonContainer'), popSound=document.getElementById('balloonPopSound');
        
        function startBalloonGame(){ 
          balloonScore=0; 
          document.getElementById('balloonScore').textContent=0;
          balloonInterval=setInterval(createBalloon, isMobile() ? 1000 : 800);
        }
        
        function stopBalloonGame(){ 
          clearInterval(balloonInterval);
          balloonContainer.innerHTML=''; 
          document.getElementById('bonusPopup').classList.remove('active');
        }
        
        function createBalloon(){ 
          const b=document.createElement('div'); 
          b.className='balloon';
          b.style.backgroundColor=`hsl(${Math.random()*360},70%,80%)`;
          b.style.left=`${Math.random()*90}%`;
          
          // Make balloons easier to tap on mobile
          if(isMobile()) {
            b.style.width = '70px';
            b.style.height = '90px';
          }
          
          // Use touchstart for mobile and click for desktop
          if(isMobile()) {
            b.addEventListener('touchstart', function(e) {
              e.preventDefault();
              popBalloon(b);
            });
          } else {
            b.addEventListener('click', function() {
              popBalloon(b);
            });
          }
          
          balloonContainer.appendChild(b);
          setTimeout(() => b.remove(), isMobile() ? 8000 : 10000);
        }
        
        function popBalloon(b){ 
          // Try to play the sound but don't break if it fails
          try {
            popSound.currentTime=0; 
            popSound.play().catch(e => console.log("Sound play failed:", e));
          } catch(e) {
            console.log("Error playing pop sound:", e);
          }
          
          b.remove(); 
          balloonScore++;
          document.getElementById('balloonScore').textContent=balloonScore;
          if(balloonScore>=5){ 
            clearInterval(balloonInterval);
            document.getElementById('bonusPopup').classList.add('active');
          }
        }
    
        // Cake Ceremony Logic
        function initCakeCeremony(){
          let lit=0;
          ['c1','c2','c3'].forEach(id => {
            const c=document.getElementById(id);
            
            // Add both click and touch handlers
            const lightCandle = function() {
              if(!c.classList.contains('lit')){ 
                c.classList.add('lit'); 
                lit++; 
              }
              if(lit===3) enableKnifeDrag();
            };
            
            c.onclick = lightCandle;
            c.ontouchstart = function(e) {
              e.preventDefault();
              lightCandle();
            };
          });
        }
        
        function enableKnifeDrag(){
          const knife=document.getElementById('knife');
          
          // For mobile: make knife draggable with touch events
          if(isMobile()) {
            let isDragging = false;
            let startY = 0;
            
            knife.ontouchstart = function(e) {
              e.preventDefault();
              isDragging = true;
              startY = e.touches[0].clientY;
              knife.style.cursor = 'grabbing';
            };
            
            document.ontouchmove = function(e) {
              if(!isDragging) return;
              
              const newY = e.touches[0].clientY;
              const cake = document.querySelector('.cake').getBoundingClientRect();
              
              // Update knife position based on touch
              knife.style.top = (newY - startY + parseInt(getComputedStyle(knife).top)) + 'px';
              
              // Check if knife has moved down enough to cut cake
              if(newY > cake.top + cake.height/2) {
                isDragging = false;
                navigateTo(6);
              }
            };
            
            document.ontouchend = function() {
              isDragging = false;
              knife.style.cursor = 'grab';
            };
          } else {
            // Desktop: use HTML5 drag and drop
            knife.draggable = true;
            knife.ondragend = e => {
              const cake = document.querySelector('.cake').getBoundingClientRect();
              if(e.clientY > cake.top + cake.height/2) navigateTo(6);
            };
          }
        }
        
        // Detect mobile devices
        function isMobile() {
          return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;
        }
    
        // Image slideshow logic
        function startImageSlideshow(){ 
          stopImageSlideshow(); 
          slideshowTimer=setInterval(nextImage, 3000); 
        }
        
        function stopImageSlideshow(){ 
          clearInterval(slideshowTimer); 
        }
        
        let currentImageIndex=0;
        
        function nextImage(){ 
          const imgs=document.querySelectorAll('.gallery-photo img');
          imgs[currentImageIndex].classList.remove('active');
          currentImageIndex=(currentImageIndex+1)%imgs.length;
          imgs[currentImageIndex].classList.add('active');
        }
    
        // Celebration/confetti logic
        function startCelebration(){ 
          navigateTo(10); 
          createConfetti(); 
        }
        
        function createConfetti(){ 
          const container=document.getElementById('confetti-container'); 
          container.innerHTML='';
          const colors=['#ff6b6b','#ffb347','#4fc3f7','#b39ddb','#81c784'];
          
          // Adjust number of confetti pieces based on device
          const confettiCount = isMobile() ? 50 : 100;
          
          for(let i=0; i<confettiCount; i++){ 
            const c=document.createElement('div'); 
            c.className='confetti';
            c.style.backgroundColor=colors[Math.floor(Math.random()*colors.length)];
            c.style.left=`${Math.random()*100}%`;
            c.style.width=`${Math.random()*10+5}px`;
            c.style.height=`${Math.random()*10+5}px`;
            c.style.animationDuration=`${Math.random()*3+2}s`;
            container.appendChild(c);
          }
        }
        
        // Handle audio autoplay issues on mobile
        document.addEventListener('click', function() {
          // Preload audio files silently after user interaction
          try {
            bgMusic.load();
            popSound.load();
          } catch(e) {
            console.log("Error preloading audio:", e);
          }
        }, {once: true});
    
        // Initialize first page
        document.addEventListener('DOMContentLoaded', function() { 
          navigateTo(1);
          
          // Apply mobile-specific adjustments
          if(isMobile()) {
            document.querySelectorAll('.btn').forEach(btn => {
              btn.style.fontSize = '14px';
            });
          }
        });
    </script>
</body>
</html>
